---
import Welcome from '../components/Welcome.astro';
import Layout from '../layouts/Layout.astro';
import "../styles/global.css";
---

<Layout title="Pomodoro Tracker">
  <main class="min-h-screen bg-neutral-950 bg-[radial-gradient(ellipse_80%_80%_at_50%_-20%,rgba(120,119,198,0.3),rgba(255,255,255,0))] flex flex-col items-center justify-center text-white font-sans p-6">
  
  <h1 class="text-5xl md:text-7xl font-black mb-12 bg-gradient-to-b from-white to-neutral-500 bg-clip-text text-transparent tracking-tighter">
    Pomodoro
  </h1>

  <div class="bg-white/[0.03] border border-white/10 backdrop-blur-xl p-12 rounded-[3rem] shadow-2xl flex flex-col items-center w-full max-w-xl">
    
    <div id="timer" class="text-8xl md:text-[10rem] font-black tabular-nums tracking-tight mb-12 drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]">
      25:00
    </div>

    <div class="flex gap-4 mb-10 w-full">
      <button id="start-btn" class="flex-1 bg-white text-black hover:bg-neutral-200 font-bold py-4 px-8 rounded-2xl text-xl transition-all active:scale-95 shadow-lg">
        Start
      </button>
      <button id="reset-btn" class="flex-1 bg-neutral-800 hover:bg-neutral-700 text-white font-bold py-4 px-8 rounded-2xl text-xl transition-all active:scale-95 border border-white/5">
        Reset
      </button>
    </div>

    <div class="grid grid-cols-2 gap-3 w-full">
      <div class="flex flex-col gap-3">
        <span class="text-xs font-bold text-neutral-500 uppercase tracking-widest ml-2">Añadir</span>
        <div class="flex gap-2">
          <button id="add-5" class="flex-1 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 border border-blue-500/20 py-2 rounded-xl text-sm font-bold transition-all">+5m</button>
          <button id="add-15" class="flex-1 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 border border-blue-500/20 py-2 rounded-xl text-sm font-bold transition-all">+15m</button>
        </div>
      </div>
      
      <div class="flex flex-col gap-3">
        <span class="text-xs font-bold text-neutral-500 uppercase tracking-widest ml-2">Descansos</span>
        <div class="flex gap-2">
          <button id="break-btn" class="flex-1 bg-orange-500/10 hover:bg-orange-500/20 text-orange-400 border border-orange-500/20 py-2 rounded-xl text-sm font-bold transition-all">Short</button>
          <button id="long-break-btn" class="flex-1 bg-orange-500/10 hover:bg-orange-500/20 text-orange-400 border border-orange-500/20 py-2 rounded-xl text-sm font-bold transition-all">Long</button>
        </div>
      </div>
    </div>
  </div>

  <p class="mt-12 text-neutral-500 text-sm font-medium">Mantén el enfoque, un ciclo a la vez.</p>
</main>
</Layout>

<script>
	
	let timeleft = 25 * 60;
	let timeId = null ;

	const timerDisplay = document.querySelector('#timer');
	const startBtn = document.querySelector('#start-btn');
	const resetBtn = document.querySelector('#reset-btn');
  const add5Btn = document.querySelector('#add-5');
  const add15Btn = document.querySelector('#add-15');
  const breakBtn = document.querySelector('#break-btn');
  const longBreakBtn = document.querySelector('#long-break-btn');
	
  
  
  const updateDisplay = () => {
		if (!timerDisplay) return;
	const minutes = Math.floor(timeleft / 60);
	const seconds = timeleft % 60;
	timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
	}

  const bell = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

	const timerStart = () => {
		if (!startBtn) return;
		if (timeId) {
			clearInterval(timeId);
			timeId = null;
			startBtn.textContent = 'Continuar';
            startBtn.classList.replace('bg-white', 'bg-orange-500/20');

		}else {
     
      startBtn.textContent = 'Pausar';
      startBtn.classList.replace('text-black', 'text-orange-400');
      
     timeId = setInterval(() => {
     timeleft--;
        updateDisplay();
        
        if (timeleft === 0) {
          clearInterval(timeId);
          bell.play();
          alert("¡Tiempo cumplido! Tómate un descanso.");
        }
      }, 1000);
    }
  }

  const bell = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');


  const resetTimer = () => {
	if (!resetBtn) return;
	if (!startBtn) return;
	clearInterval(timeId);
	timeId = null;
	timeleft = 25 * 60;
    updateDisplay();
    startBtn.textContent = 'Iniciar';
    
  }



  const breakTimer = () => {
	if (!resetBtn) return;
	if (!startBtn) return;
	clearInterval(timeId);
	timeId = null;
	timeleft = 5 * 60;
    updateDisplay();
    startBtn.textContent = 'Iniciar';
  }
   const longBreakTimer = () => {
	if (!resetBtn) return;
	if (!startBtn) return;
	clearInterval(timeId);
	timeId = null;
	timeleft = 15 * 60;
    updateDisplay();
    startBtn.textContent = 'Iniciar';
  }
 

  startBtn.addEventListener('click', timerStart);
  resetBtn.addEventListener('click', resetTimer);
  breakBtn.addEventListener('click', breakTimer);
  longBreakBtn.addEventListener('click', longBreakTimer);

add5Btn.addEventListener('click', () => {
    timeleft += 5 * 60;
    updateDisplay();
  });

  add15Btn.addEventListener('click', () => {
    timeleft += 15 * 60;
    updateDisplay();
  });

</script>
